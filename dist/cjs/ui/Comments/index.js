"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React),ApolloClient=require("apollo-boost"),ApolloClient__default=_interopDefault(ApolloClient),reactHooks=require("@apollo/react-hooks"),formatDistanceToNow=_interopDefault(require("date-fns/formatDistanceToNow"));function asyncGeneratorStep(e,t,r,n,a,o,c){try{var l=e[o](c),i=l.value}catch(e){return void r(e)}l.done?t(i):Promise.resolve(i).then(n,a)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function c(e){asyncGeneratorStep(o,n,a,c,l,"next",e)}function l(e){asyncGeneratorStep(o,n,a,c,l,"throw",e)}c(void 0)}))}}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],n=!0,a=!1,o=void 0;try{for(var c,l=e[Symbol.iterator]();!(n=(c=l.next()).done)&&(r.push(c.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(a)throw o}}return r}}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function styleInject(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===r&&n.firstChild?n.insertBefore(a,n.firstChild):n.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}var css=".textArea-module_textArea__jOs0v {\n  border-radius: 5px;\n  width: calc(100% - 20px - 10px - 2px);\n  padding: 10px;\n  margin: 5px;\n  border: 1.5px solid;\n  resize: none;\n  font-family: inherit;\n  font-size: inherit; }\n  .textArea-module_textArea__jOs0v:focus {\n    outline: none; }\n\n.textArea-module_message__356sA {\n  height: 70px;\n  width: 100%; }\n\n.textArea-module_normal__252TE {\n  border-color: red; }\n\n.textArea-module_notFocused__39uMv {\n  color: #b7b7b7 !important;\n  border-color: #b7b7b7 !important; }\n\n.textArea-module_error__3cOzU {\n  border-color: red !important; }\n",css$1={textArea:"textArea-module_textArea__jOs0v",message:"textArea-module_message__356sA",normal:"textArea-module_normal__252TE",notFocused:"textArea-module_notFocused__39uMv",error:"textArea-module_error__3cOzU"};styleInject(css);var TIMEOUT=2e3,TextArea=function(e){var t=e.onSubmit,r=e.setInputState,n=e.inputState,a=_slicedToArray(React.useState(!1),2),o=a[0],c=a[1],l=_slicedToArray(React.useState(""),2),i=l[0],u=l[1],s=!1;React.useEffect((function(){var e;return"done"===n&&(e=setTimeout((function(){c(!1),r("ready")}),TIMEOUT)),function(){e&&clearTimeout(e)}}),[n,r]);var d=function(e){if(13===e.keyCode&&!1===e.shiftKey){s=!0;var r=i.trim();if(0===r.length)return;return t(r),void u("")}if(s)s=!1;else{var n=e.target.value||"";u(n)}},m=[css$1.textArea];return o?m.push(css$1.normal):m.push(css$1.notFocused),["sending","done"].includes(n)?"DONE":React__default.createElement("textarea",{value:i,onChange:d,onKeyDown:d,onFocus:function(){return c(!0)},onBlur:function(){return c(!1)},className:m.join(" "),placeholder:"Join the discussion..."})},TextArea$1=React__default.memo(TextArea),css$2={},Comment=function(e){var t=e.text,r=e.createdAt,n=React.useCallback((function(){return formatDistanceToNow(new Date(r),{addSuffix:!0})}),[r]);return React__default.createElement("div",{className:css$2.comment},React__default.createElement("div",{className:css$2.hedaer},React__default.createElement("span",{className:css$2.name},"FEJKNAME"),React__default.createElement("span",{className:css$2.date},n())),React__default.createElement("p",{className:css$2.text},t))};function _templateObject2(){var e=_taggedTemplateLiteral(["\n  mutation createComment($text: String!, $code: String!) {\n    createComment(data: { text: $text, code: $code }) {\n      id\n      text\n      createdAt\n    }\n  }\n"]);return _templateObject2=function(){return e},e}function _templateObject(){var e=_taggedTemplateLiteral(["\n  query getComments($code: String!) {\n    getComments(where: { code: $code }) {\n      id\n      text\n      createdAt\n    }\n  }\n"]);return _templateObject=function(){return e},e}var API="https://suite.chimp.click/graphql",client=new ApolloClient__default({uri:API}),GET_COMMENTS=ApolloClient.gql(_templateObject()),ADD_COMMENT=ApolloClient.gql(_templateObject2()),Comments=function(e){var t=e.code,r=e.authKey,n=_slicedToArray(React.useState([]),2),a=n[0],o=n[1],c=reactHooks.useQuery(GET_COMMENTS,{variables:{code:t},context:{headers:{authorization:r}}}),l=c.loading,i=c.data,u=_slicedToArray(reactHooks.useMutation(ADD_COMMENT),1)[0],s=_slicedToArray(React.useState("ready"),2),d=s[0],m=s[1],_=React.useCallback(function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(n){var c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m("sending"),e.next=3,u({variables:{text:n,code:t},context:{headers:{authorization:r}}});case 3:c=e.sent,l=c.data.createComment,o([l].concat(_toConsumableArray(a))),m("done");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[u,r,a,t]);return React__default.createElement("div",null,React__default.createElement(TextArea$1,{onSubmit:_,inputState:d,setInputState:m}),l?"LOADING":React__default.createElement(React__default.Fragment,null,0===a.length&&0===i.getComments.length?"EMPTY":React__default.createElement(React__default.Fragment,null,a.map((function(e){return React__default.createElement(Comment,_extends({key:e.id},e))})),i.getComments.map((function(e){return React__default.createElement(Comment,_extends({key:e.id},e))})))))},CommentsWrapper=function(){return React__default.createElement(reactHooks.ApolloProvider,{client:client},React__default.createElement(Comments,{authKey:"835b553fb710a95a026c790dd54eb97b70efa3993f9d22ef2599be4a354153e0",code:"about"}))};exports.default=CommentsWrapper;
