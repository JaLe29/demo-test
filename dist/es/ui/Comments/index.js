import e,{useState as t,useEffect as n,useCallback as r}from"react";import o,{gql as a}from"apollo-boost";import{ApolloProvider as i,useQuery as c,useMutation as u}from"@apollo/react-hooks";import l from"date-fns/formatDistanceToNow";function d(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function m(){return(m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function s(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function p(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var h="textArea-module_textArea__jOs0v",v="textArea-module_normal__252TE",x="textArea-module_notFocused__39uMv";!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}(".textArea-module_textArea__jOs0v {\n  border-radius: 5px;\n  width: calc(100% - 20px - 10px - 2px);\n  padding: 10px;\n  margin: 5px;\n  border: 1.5px solid;\n  resize: none;\n  font-family: inherit;\n  font-size: inherit; }\n  .textArea-module_textArea__jOs0v:focus {\n    outline: none; }\n\n.textArea-module_message__356sA {\n  height: 70px;\n  width: 100%; }\n\n.textArea-module_normal__252TE {\n  border-color: red; }\n\n.textArea-module_notFocused__39uMv {\n  color: #b7b7b7 !important;\n  border-color: #b7b7b7 !important; }\n\n.textArea-module_error__3cOzU {\n  border-color: red !important; }\n");var y=e.memo((function(r){var o=r.onSubmit,a=r.setInputState,i=r.inputState,c=f(t(!1),2),u=c[0],l=c[1],d=f(t(""),2),m=d[0],s=d[1],p=!1;n((function(){var e;return"done"===i&&(e=setTimeout((function(){l(!1),a("ready")}),2e3)),function(){e&&clearTimeout(e)}}),[i,a]);var y=function(e){if(13===e.keyCode&&!1===e.shiftKey){p=!0;var t=m.trim();if(0===t.length)return;return o(t),void s("")}if(p)p=!1;else{var n=e.target.value||"";s(n)}},b=[h];return u?b.push(v):b.push(x),["sending","done"].includes(i)?"DONE":e.createElement("textarea",{value:m,onChange:y,onKeyDown:y,onFocus:function(){return l(!0)},onBlur:function(){return l(!1)},className:b.join(" "),placeholder:"Join the discussion..."})})),b={},g=function(t){var n=t.text,o=t.createdAt,a=r((function(){return l(new Date(o),{addSuffix:!0})}),[o]);return e.createElement("div",{className:b.comment},e.createElement("div",{className:b.hedaer},e.createElement("span",{className:b.name},"FEJKNAME"),e.createElement("span",{className:b.date},a())),e.createElement("p",{className:b.text},n))};function A(){var e=s(["\n  mutation createComment($text: String!, $code: String!) {\n    createComment(data: { text: $text, code: $code }) {\n      id\n      text\n      createdAt\n    }\n  }\n"]);return A=function(){return e},e}function _(){var e=s(["\n  query getComments($code: String!) {\n    getComments(where: { code: $code }) {\n      id\n      text\n      createdAt\n    }\n  }\n"]);return _=function(){return e},e}var E=new o({uri:"https://suite.chimp.click/graphql"}),w=a(_()),S=a(A()),O=function(n){var o=n.code,a=n.authKey,i=f(t([]),2),l=i[0],s=i[1],h=c(w,{variables:{code:o},context:{headers:{authorization:a}}}),v=h.loading,x=h.data,b=f(u(S),1)[0],A=f(t("ready"),2),_=A[0],E=A[1],O=r(function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E("sending"),e.next=3,b({variables:{text:t,code:o},context:{headers:{authorization:a}}});case 3:n=e.sent,r=n.data.createComment,s([r].concat(p(l))),E("done");case 7:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){d(a,r,o,i,c,"next",e)}function c(e){d(a,r,o,i,c,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}(),[b,a,l,o]);return e.createElement("div",null,e.createElement(y,{onSubmit:O,inputState:_,setInputState:E}),v?"LOADING":e.createElement(e.Fragment,null,0===l.length&&0===x.getComments.length?"EMPTY":e.createElement(e.Fragment,null,l.map((function(t){return e.createElement(g,m({key:t.id},t))})),x.getComments.map((function(t){return e.createElement(g,m({key:t.id},t))})))))};export default function(){return e.createElement(i,{client:E},e.createElement(O,{authKey:"835b553fb710a95a026c790dd54eb97b70efa3993f9d22ef2599be4a354153e0",code:"about"}))}
